<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Resilience Assessment</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* General Styles */
        :root {
            --primary-color: #005f73;
            --secondary-color: #0a9396;
            --accent-color: #94d2bd;
            --light-color: #f0f0f0; /* Light grey for unselected options */
            --dark-color: #001219;
            --heart-color: #dc3545;
            --safety-color: #ffc107;
            --resilience-color: #28a745;
            --font-family: 'Inter', sans-serif;
            --border-radius: 8px;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');

        body {
            font-family: var(--font-family);
            margin: 0;
            background-color: #f8f9fa;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1rem;
        }

        /* Views */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Card Styles */
        .card {
            background-color: #ffffff;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #fff;
        }

        .btn-primary {
            background-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
        }

        /* Typography */
        h1, h2, h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.5rem; }

        /* Landing Page */
        #landing-page .hero {
            text-align: center;
            padding: 2rem 0;
        }

        #landing-page .hero .btn-group {
            justify-content: center;
        }

        .layers-intro {
            display: flex;
            justify-content: space-around;
            gap: 1.5rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .layer-card {
            flex: 1;
            min-width: 250px;
            text-align: center;
            padding: 1.5rem;
        }

        .layer-card svg {
            width: 60px;
            height: 60px;
            margin-bottom: 1rem;
        }

        .layer-card.heart { border-top: 5px solid var(--heart-color); }
        .layer-card.safety { border-top: 5px solid var(--safety-color); }
        .layer-card.resilience { border-top: 5px solid var(--resilience-color); }

        /* Assessment Page */
        #progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
        }

        #progress-bar {
            width: 0%;
            height: 20px;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            transition: width 0.4s ease;
            text-align: center;
            color: white;
            line-height: 20px;
            font-size: 0.8rem;
        }

        #question-category {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        #question-explainer {
            font-size: 0.95rem;
            color: #495057;
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--accent-color);
        }

        #question-text {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            display: block;
            background: var(--light-color);
            color: var(--dark-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .option:hover {
            border-color: var(--accent-color);
        }

        .option input[type="radio"] {
            display: none;
        }

        .option input[type="radio"]:checked + label {
            font-weight: 700;
        }

        .option.selected {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: #fff;
        }

        .option.selected label {
             color: #fff;
        }

        .option label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        #error-message {
            color: var(--heart-color);
            font-weight: 500;
            margin-top: 1rem;
            display: none;
        }

        /* Results Page */
        #results-page .results-summary {
            text-align: center;
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
        }

        #results-layer {
            font-size: 2.5rem;
            font-weight: 700;
        }

        #results-risk {
            font-size: 1.2rem;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            color: white;
            display: inline-block;
            margin-top: 0.5rem;
        }

        .category-breakdown, .threats-section, .recommendations-section {
            margin-top: 2rem;
        }

        .category-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid #eee;
        }

        .category-score-bar-container {
            flex-grow: 1;
            height: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin: 0 1rem;
        }

        .category-score-bar {
            height: 100%;
            background-color: var(--secondary-color);
            border-radius: 5px;
        }

        .threats-list, .recommendations-list {
            list-style: none;
            padding: 0;
        }

        .threats-list li, .recommendations-list li {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 0.8rem;
            border-left: 4px solid var(--accent-color);
        }

        .recommendation-item {
            border-left-color: var(--primary-color) !important;
        }

        .recommendation-item strong {
            display: block;
            color: var(--primary-color);
            margin-bottom: 0.3rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 1rem auto;
                padding: 0.5rem;
            }

            h1 { font-size: 2rem; }
            h2 { font-size: 1.75rem; }
            h3 { font-size: 1.25rem; }

            .layers-intro {
                flex-direction: column;
            }

            .btn-group {
                flex-direction: column;
                width: 100%;
            }
            .btn {
                width: 100%;
                text-align: center;
            }
        }

        /* Contextual Risk */
        #context-section {
            margin-top: 2rem;
        }
        #context-section h3 {
            margin-bottom: 1rem;
        }
        .context-options {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .context-option {
            display: block;
            background: #f8f9fa;
            padding: 0.8rem 1.2rem;
            border-radius: 20px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        .context-option.selected {
            background-color: #e2f3f5;
            border-color: var(--secondary-color);
            font-weight: 500;
        }
        .context-option input {
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Landing Page View -->
        <div id="landing-page" class="view active">
            <div class="card hero">
                <h1>Digital Resilience Assessment</h1>
                <p>Understand your organization's cybersecurity posture and get personalized recommendations for improvement based on the Resilience Maturity Model.</p>
                <div class="btn-group">
                    <button id="start-assessment-btn" class="btn btn-primary">Start New Assessment</button>
                    <button id="continue-assessment-btn" class="btn btn-secondary" style="display: none;">Continue Previous Assessment</button>
                </div>
            </div>

            <div class="layers-intro">
                <div class="card layer-card heart">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    <h3>Heart Layer: Survival</h3>
                    <p>Focuses on the essential, core capabilities needed to survive a basic cyber incident. Lacks foundational security controls.</p>
                </div>
                <div class="card layer-card safety">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>
                    <h3>Safety Layer: Stability</h3>
                    <p>Implements foundational security measures for stability and protection against common threats. Vulnerable to sophisticated attacks.</p>
                </div>
                <div class="card layer-card resilience">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9zm0 16c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zm-1-11h2v6h-2zm0 8h2v2h-2z"/></svg>
                    <h3>Resilience Layer: Automation</h3>
                    <p>Achieves a mature, automated, and future-proofed security posture capable of withstanding advanced threats.</p>
                </div>
            </div>
        </div>

        <!-- Assessment View -->
        <div id="assessment-page" class="view">
            <div id="progress-container">
                <div id="progress-bar"></div>
            </div>
            <div class="card">
                <div id="question-category">Category</div>
                <div id="question-explainer">Explainer text goes here.</div>
                <h2 id="question-text">Question text goes here.</h2>
                <div class="options-container" id="options-container">
                    <!-- Options will be dynamically inserted here -->
                </div>

                <p id="error-message">Please select an option to continue.</p>

                <!-- Contextual Risk Section (shown on the first question) -->
                <div id="context-section" style="display: none;">
                    <h3>What is your organization's operational context?</h3>
                    <p>Select all that apply. This helps tailor the risk assessment.</p>
                    <div class="context-options" id="context-options-container">
                        <!-- Context options will be dynamically inserted here -->
                    </div>
                </div>

                <div class="btn-group">
                    <button id="prev-btn" class="btn btn-secondary">Previous</button>
                    <button id="next-btn" class="btn btn-primary">Next</button>
                    <button id="finish-btn" class="btn btn-primary" style="display: none;">Finish Assessment</button>
                </div>
                 <button id="save-continue-btn" class="btn btn-secondary" style="margin-top: 1rem;">Save & Continue Later</button>
            </div>
        </div>

        <!-- Results View -->
        <div id="results-page" class="view">
            <div id="results-content">
                <div class="card results-summary">
                    <h2>Your Resilience Score</h2>
                    <div id="results-layer">Layer Name</div>
                    <div id="results-risk">Risk Level</div>
                    <p id="results-description" style="margin-top: 1rem;">Description of the layer.</p>
                    <p id="contextual-note" style="font-style: italic; color: #fff; font-weight: 500;"></p>
                </div>

                <div class="card category-breakdown">
                    <h3>Category Performance</h3>
                    <div id="category-scores-container"></div>
                </div>

                <div class="card threats-section">
                    <h3>Potential Threats for Your Layer</h3>
                    <ul id="threats-list" class="threats-list"></ul>
                </div>

                <div class="card recommendations-section">
                    <h3>Personalized Recommendations</h3>
                    <div id="recommendations-container"></div>
                </div>
            </div>

            <div class="btn-group">
                <button id="export-pdf-btn" class="btn btn-primary">Export to PDF</button>
                <button id="retake-assessment-btn" class="btn btn-secondary">Retake Assessment</button>
                <button id="home-btn" class="btn btn-secondary">Go to Home</button>
            </div>
        </div>
    </div>

    <script>
    // --- js/questions.js ---
    const questions = [
      // Core Data & Business Continuity
      {
        id: 1,
        category: "Core Data & Business Continuity",
        explainer: "Backups are simply copies of your important information. If the original files are lost or destroyed (e.g., by a ransomware attack or hardware failure), you can use the backup to restore them. An 'offsite' backup is crucial because it's stored in a different physical location, like the cloud, so a local disaster like a fire or theft won't also destroy your only copy. <br><br><b>Example:</b> Think of it like having a spare key to your house that you keep at a trusted friend's place instead of under your own doormat.",
        question: "Do you have a secure, offsite backup strategy for critical data?",
        options: [
          { text: "No backups", points: 0, layer: "Heart" },
          { text: "Backups exist but not automated or regularly tested", points: 1, layer: "Safety" },
          { text: "Automated, tested backups with redundancy", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 2,
        category: "Core Data & Business Continuity",
        explainer: "An Incident Response Plan (IRP) is a pre-written guide for what to do when a security problem, like a data breach or hack, occurs. It outlines who to call, what steps to take, and who is responsible for each task. Having a plan means you can act quickly and effectively during a crisis, rather than panicking and trying to figure things out on the fly. <br><br><b>Example:</b> An IRP is like a fire escape plan for your office, but for a cyberattack.",
        question: "Is there an incident response plan (IRP) in place?",
        options: [
          { text: "No IRP", points: 0, layer: "Heart" },
          { text: "Exists but rarely tested", points: 1, layer: "Safety" },
          { text: "Well-documented, tested regularly, and updated", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 3,
        category: "Core Data & Business Continuity",
        explainer: "A Business Impact Analysis (BIA) is a process to figure out which parts of your organization are the most essential. It helps you answer the question: 'If this system or process stops working, how badly does it hurt our mission?' This allows you to prioritize your security efforts on protecting what matters most. <br><br><b>Example:</b> A BIA might reveal that your donor database is your most critical asset, meaning it should have stronger protections than your internal staff directory.",
        question: "Have you conducted a business impact analysis (BIA)?",
        options: [
          { text: "No BIA", points: 0, layer: "Heart" },
          { text: "Performed but not recently updated", points: 1, layer: "Safety" },
          { text: "Performed regularly and integrated into security strategy", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 4,
        category: "Core Data & Business Continuity",
        explainer: "A Disaster Recovery (DR) plan contains the specific, technical instructions for getting your systems and services back online after a major disruption. While an Incident Response Plan is about managing the crisis itself, the DR plan is the step-by-step 'how-to' guide for your technical team to actually rebuild and restore everything. <br><br><b>Example:</b> If a critical server fails, the DR plan would have the detailed instructions for setting up a new one and restoring its data from your backups.",
        question: "Do you have a disaster recovery (DR) plan?",
        options: [
          { text: "No DR plan", points: 0, layer: "Heart" },
          { text: "Exists but not regularly tested", points: 1, layer: "Safety" },
          { text: "Regularly tested, documented, and integrated into business operations", points: 2, layer: "Resilience" }
        ]
      },
      // Access Control & Authentication
      {
        id: 5,
        category: "Access Control & Authentication",
        explainer: "This question is about how you protect access to accounts. Password policies prevent easily guessed passwords (like 'Password123'). Multi-Factor Authentication (MFA) adds a vital second layer of security, such as a code sent to your phone. This means that even if an attacker steals a password, they still can't get in. <br><br><b>Example:</b> Using MFA is like needing both a key and a secret PIN to open a safe, not just the key.",
        question: "How are user passwords managed?",
        options: [
          { text: "Weak passwords, no policies", points: 0, layer: "Heart" },
          { text: "Password policies in place, MFA optional", points: 1, layer: "Safety" },
          { text: "Enforced MFA, password vaults, zero-trust principles", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 6,
        category: "Access Control & Authentication",
        explainer: "Role-Based Access Control (RBAC) is the practice of giving people access only to the information and systems they absolutely need to do their jobs. This is also known as the 'principle of least privilege.' It significantly limits the potential damage if one person's account is compromised by an attacker. <br><br><b>Example:</b> A member of the communications team should not have access to sensitive financial records, and RBAC is the system that enforces this separation.",
        question: "Do employees have role-based access control (RBAC)?",
        options: [
          { text: "No restrictions on access", points: 0, layer: "Heart" },
          { text: "Some access restrictions, but no formal policy", points: 1, layer: "Safety" },
          { text: "Well-defined RBAC, least privilege model enforced", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 7,
        category: "Access Control & Authentication",
        explainer: "Privileged accounts, often called 'admin' or 'super-user' accounts, have powerful permissions that allow them to make major changes to systems. Because they are so powerful, it's critical to monitor their use very closely to ensure they are only being used for legitimate purposes and to immediately detect any suspicious activity. <br><br><b>Example:</b> Monitoring these accounts is like having extra security cameras and guards focused on the room where the master keys to the entire building are kept.",
        question: "Are privileged accounts monitored and audited?",
        options: [
          { text: "No monitoring or auditing", points: 0, layer: "Heart" },
          { text: "Some monitoring but inconsistently applied", points: 1, layer: "Safety" },
          { text: "Fully audited and monitored with alerts for anomalies", points: 2, layer: "Resilience" }
        ]
      },
      // Threat Monitoring & Detection
      {
        id: 8,
        category: "Threat Monitoring & Detection",
        explainer: "This is about having security systems that actively watch your network and computers for signs of an attack *as it is happening*. Instead of discovering a breach weeks or months after the fact, real-time monitoring can provide an immediate alert, giving you a chance to stop the attack before major damage is done. <br><br><b>Example:</b> This is like a burglar alarm that goes off the moment someone breaks a window, rather than just reviewing security camera footage the next morning.",
        question: "Do you have real-time monitoring for cybersecurity threats?",
        options: [
          { text: "No monitoring or logging", points: 0, layer: "Heart" },
          { text: "Basic logging but no real-time detection", points: 1, layer: "Safety" },
          { text: "SIEM/XDR deployed with proactive monitoring", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 9,
        category: "Threat Monitoring & Detection",
        explainer: "Your computers, servers, and network devices all create 'logs,' which are detailed records of all the activity that occurs. Storing and reviewing these logs is essential for investigating what happened after a security incident. It can also help you spot unusual patterns that might indicate a hidden or ongoing threat. <br><br><b>Example:</b> Reviewing logs is like a detective examining security footage and footprints to piece together how a crime occurred.",
        question: "Are logs stored and reviewed periodically?",
        options: [
          { text: "No logging or review process", points: 0, layer: "Heart" },
          { text: "Logs stored but only reviewed manually", points: 1, layer: "Safety" },
          { text: "Logs analyzed using AI-driven threat intelligence", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 10,
        category: "Threat Monitoring & Detection",
        explainer: "Endpoint Detection and Response (EDR) is like an advanced, smarter version of antivirus software. It doesn't just look for known viruses; it actively monitors the *behavior* of programs on your computers (the 'endpoints'). If a program starts acting suspiciously, like trying to encrypt files like ransomware would, the EDR can block it automatically, even if it's a brand-new threat. <br><br><b>Example:</b> An EDR is like a security guard who is trained to recognize suspicious behavior, not just identify known criminals from a photo.",
        question: "Do you have endpoint detection and response (EDR) solutions?",
        options: [
          { text: "No EDR", points: 0, layer: "Heart" },
          { text: "Basic antivirus installed, but lacks behavioral detection", points: 1, layer: "Safety" },
          { text: "Fully deployed EDR with threat intelligence and automated responses", points: 2, layer: "Resilience" }
        ]
      },
      // Security Awareness & Training
      {
        id: 11,
        category: "Security Awareness & Training",
        explainer: "Your people are one of your most important lines of defense against cyberattacks. Regular security awareness training helps ensure that all staff members can recognize current threats (like phishing scams), know what suspicious activity to look for, and understand their personal responsibility in keeping the organization's data safe. <br><br><b>Example:</b> Just as you would train staff on physical safety procedures like what to do in a fire, you must also train them on digital safety.",
        question: "Do employees receive regular cybersecurity awareness training?",
        options: [
          { text: "No training", points: 0, layer: "Heart" },
          { text: "Occasional training, not mandatory", points: 1, layer: "Safety" },
          { text: "Mandatory, continuous, and simulated attack exercises", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 12,
        category: "Security Awareness & Training",
        explainer: "'Phishing' is a type of attack where a criminal sends a fake email that looks legitimate, trying to trick someone into revealing their password or clicking a malicious link. Phishing simulations are controlled, safe tests where you send harmless, fake phishing emails to your own staff. This helps you see who might be vulnerable and provides a practical learning experience. <br><br><b>Example:</b> A phishing simulation is a practical test that helps reinforce training and measure how well your staff can spot a fake.",
        question: "Has the organization conducted phishing simulations?",
        options: [
          { text: "No phishing tests", points: 0, layer: "Heart" },
          { text: "Occasionally, but employees still fall for attacks", points: 1, layer: "Safety" },
          { text: "Regular testing with decreasing failure rates", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 13,
        category: "Security Awareness & Training",
        explainer: "Different roles within your organization face different types of security risks. For instance, staff in your finance department who can authorize payments need different, more specific training than general staff. This question asks if your training is tailored to address the unique risks associated with different jobs. <br><br><b>Example:</b> A pilot and a flight attendant both receive safety training, but the pilot's training is far more technical and specific to their high-risk role.",
        question: "Do employees undergo role-specific security training?",
        options: [
          { text: "No role-specific training", points: 0, layer: "Heart" },
          { text: "General training but not role-based", points: 1, layer: "Safety" },
          { text: "Tailored security training for high-risk roles", points: 2, layer: "Resilience" }
        ]
      },
      // Incident Response & Recovery
      {
        id: 14,
        category: "Incident Response & Recovery",
        explainer: "This is about actively practicing your response to a cyberattack before a real one happens. 'Tabletop exercises' are guided discussions where your team walks through a simulated incident to test your response plan. 'Penetration tests' are when you hire ethical hackers to actively try to break into your systems. Both help you find and fix weaknesses in a safe environment. <br><br><b>Example:</b> A recovery drill is the cybersecurity equivalent of a full-scale fire drill, complete with simulated emergencies.",
        question: "Do you have cyber incident recovery drills?",
        options: [
          { text: "No formal drills", points: 0, layer: "Heart" },
          { text: "Drills exist but only done after an incident", points: 1, layer: "Safety" },
          { text: "Regular tabletop exercises and penetration tests", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 15,
        category: "Incident Response & Recovery",
        explainer: "If your organization suffers a major data breach or outage, how will you communicate with your staff, clients, donors, partners, and the public? A crisis communication strategy is a pre-approved plan that details what to say, who should say it, and when. This ensures you communicate clearly, consistently, and responsibly during a high-stress event. <br><br><b>Example:</b> This plan prevents a chaotic, contradictory public response and helps maintain trust even during a crisis.",
        question: "Is there a crisis communication strategy?",
        options: [
          { text: "No formalized plan", points: 0, layer: "Heart" },
          { text: "Exists but not well-integrated", points: 1, layer: "Safety" },
          { text: "Fully defined strategy with stakeholder engagement", points: 2, layer: "Resilience" }
        ]
      },
      // Infrastructure & Automation
      {
        id: 16,
        category: "Infrastructure & Automation",
        explainer: "All software has flaws, and some of these can be security vulnerabilities that attackers can exploit. 'Patching' is the critical process of applying the updates that software vendors release to fix these security holes. Automating this process ensures that your systems are protected against the latest known threats as quickly as possible. <br><br><b>Example:</b> Failing to patch your software is like hearing about a faulty lock on your model of door and choosing not to replace it.",
        question: "Do you have automated security patches and updates?",
        options: [
          { text: "No formal update process", points: 0, layer: "Heart" },
          { text: "Manual updates, some automation", points: 1, layer: "Safety" },
          { text: "Fully automated patch management", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 17,
        category: "Infrastructure & Automation",
        explainer: "This is about designing your technical systems to withstand the failure of a single component. 'Redundancy' means having duplicate or backup components (like two power supplies in a server). 'Failover' means that if one system fails, a backup system automatically takes over with little to no disruption to your services. <br><br><b>Example:</b> A large airplane has multiple engines; this is redundancy, so that if one fails, the plane can still fly safely.",
        question: "Is your infrastructure designed with failover and redundancy mechanisms?",
        options: [
          { text: "No redundancy", points: 0, layer: "Heart" },
          { text: "Basic failover in place", points: 1, layer: "Safety" },
          { text: "Full redundancy with geo-distributed backups", points: 2, layer: "Resilience" }
        ]
      },
      // Compliance & Risk Management
      {
        id: 18,
        category: "Compliance & Risk Management",
        explainer: "This question asks if you follow an established, expert-created set of cybersecurity best practices, often called a framework or standard (e.g., NIST Cybersecurity Framework, ISO 27001). Aligning with a standard demonstrates that you are taking a structured, comprehensive, and recognized approach to managing your security. <br><br><b>Example:</b> In construction, builders must follow specific building codes for safety; in cybersecurity, organizations can follow standards like NIST.",
        question: "Are you aligned with cybersecurity standards (e.g., ISO 27001, NIST, GDPR)?",
        options: [
          { text: "No compliance efforts", points: 0, layer: "Heart" },
          { text: "Partial compliance, work in progress", points: 1, layer: "Safety" },
          { text: "Fully compliant with periodic audits", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 19,
        category: "Compliance & Risk Management",
        explainer: "A risk assessment is a formal process where you identify, analyze, and evaluate potential security risks to your organization. It helps you understand your biggest threats (e.g., data theft, ransomware, service outages) so you can make intelligent, prioritized decisions about where to invest your limited security time and budget. <br><br><b>Example:</b> A homeowner might assess the risk of a flood and decide to buy flood insurance; a cyber risk assessment helps you decide which security 'insurance' you need most.",
        question: "Do you perform regular risk assessments?",
        options: [
          { text: "No risk assessments", points: 0, layer: "Heart" },
          { text: "Conducted annually", points: 1, layer: "Safety" },
          { text: "Continuous risk management with predictive analysis", points: 2, layer: "Resilience" }
        ]
      },
      {
        id: 20,
        category: "Compliance & Risk Management",
        explainer: "When you use a third-party service or software (like a cloud email provider, a payment processor, or a donor management platform), you are trusting that vendor with your organization's data. This question asks if you evaluate the security practices of these vendors *before* you start using them, to ensure they aren't a weak link in your security. <br><br><b>Example:</b> Before hiring a company to transport money, you would check their security, insurance, and reputation. You should do the same for your data.",
        question: "Do you have third-party vendor security assessments?",
        options: [
          { text: "No vendor security checks", points: 0, layer: "Heart" },
          { text: "Basic due diligence but not a formal process", points: 1, layer: "Safety" },
          { text: "Full vendor risk management program", points: 2, layer: "Resilience" }
        ]
      }
    ];
    const highRiskContexts = [
        'works with vulnerable populations',
        'operates in conflict zones',
        'handles sensitive political data',
        'investigative journalism',
        'human rights activism',
        'election monitoring'
    ];

    // --- js/scoring.js ---
    const categoryWeights = {
      "Core Data & Business Continuity": 2.5,
      "Access Control & Authentication": 2.0,
      "Threat Monitoring & Detection": 2.0,
      "Security Awareness & Training": 1.5,
      "Incident Response & Recovery": 2.0,
      "Infrastructure & Automation": 1.5,
      "Compliance & Risk Management": 1.0
    };

    function calculateScores(answers) {
      let totalWeightedScore = 0;
      let maxPossibleScore = 0;
      const categoryScores = {};

      questions.forEach(q => {
          const weight = categoryWeights[q.category];
          const answer = answers[q.id];
          const questionScore = answer ? answer.points : 0;

          totalWeightedScore += questionScore * weight;
          maxPossibleScore += 2 * weight; // Max points is 2

          if (!categoryScores[q.category]) {
              categoryScores[q.category] = { score: 0, maxScore: 0, count: 0 };
          }
          categoryScores[q.category].score += questionScore * weight;
          categoryScores[q.category].maxScore += 2 * weight;
          categoryScores[q.category].count++;
      });

      const percentage = maxPossibleScore > 0 ? (totalWeightedScore / maxPossibleScore) * 100 : 0;

      return { weightedScore: totalWeightedScore, percentage: percentage, categoryScores };
    }

    function calculateLayer(scoreData) {
      const { percentage } = scoreData;
      if (percentage < 35) {
        return {
          layer: "Heart Layer - Survival",
          risk: "High Risk",
          description: "Organization lacks basic cybersecurity measures and is at high risk.",
          color: "var(--heart-color)",
          priority: "Immediate action required",
          threats: [
            "Data Loss & Integrity: Accidental deletions, ransomware, insider threats",
            "Communication Security: Unencrypted emails, insecure messaging apps",
            "Access & Authentication: Shared passwords, no MFA, weak passwords",
            "Lack of Incident Response: No plan for handling cyberattacks",
            "Regulatory and Compliance Risks: No adherence to data protection laws"
          ]
        };
      } else if (percentage < 70) {
        return {
          layer: "Safety Layer - Stability & Protection",
          risk: "Medium Risk",
          description: "Organization has foundational security but remains vulnerable to sophisticated threats.",
          color: "var(--safety-color)",
          priority: "Continued improvement needed",
          threats: [
            "Phishing & Social Engineering: Spear phishing, business email compromise",
            "Malware & Ransomware: Drive-by downloads, malicious email attachments",
            "Insider Threats: Employees leaking data, disgruntled staff causing damage",
            "Shadow IT: Staff using unauthorized tools & services",
            "Lack of Threat Monitoring: No logging or anomaly detection"
          ]
        };
      } else {
        return {
          layer: "Resilience Layer - Automation & Future-Proofing",
          risk: "Low Risk",
          description: "Organization has achieved mature cybersecurity posture with automation and resilience strategies.",
          color: "var(--resilience-color)",
          priority: "Maintain and enhance current posture",
          threats: [
            "Advanced Persistent Threats (APTs): Surveillance, spyware, long-term espionage",
            "Zero-Day Vulnerabilities: Exploits with no known fixes",
            "Denial-of-Service (DoS/DDoS): Targeted attacks against infrastructure",
            "AI-Powered Threats: Deepfake scams, AI-generated phishing",
            "Cloud & SaaS Vulnerabilities: API abuse, misconfigurations"
          ]
        };
      }
    }

    function applyContextualRisk(layerResult, organizationContext) {
      let adjustedResult = { ...layerResult, contextualNote: '' };
      const isHighRiskContext = highRiskContexts.some(context => organizationContext.includes(context));

      if (isHighRiskContext) {
        if (layerResult.layer === "Heart Layer - Survival") {
            adjustedResult.risk = "Critical Risk";
            adjustedResult.contextualNote = "Risk elevated to Critical due to high-risk operational context.";
        } else if (layerResult.layer === "Safety Layer - Stability & Protection") {
            adjustedResult.risk = "High Risk";
            adjustedResult.contextualNote = "Risk elevated to High due to high-risk operational context.";
        } else {
            adjustedResult.contextualNote = "Note: Operating in a high-risk context requires constant vigilance.";
        }
      }
      return adjustedResult;
    }


    // --- js/recommendations.js ---
    function generateRecommendations(answers) {
        const recommendations = {
            immediate: [],
            shortTerm: [],
            longTerm: []
        };

        questions.forEach(q => {
            const answer = answers[q.id];
            const questionScore = answer ? answer.points : 0;
            const weight = categoryWeights[q.category];
            const recommendationText = getRecommendationForQuestion(q.id, questionScore);

            if (questionScore < 2 && recommendationText) {
                const recommendation = {
                    category: q.category,
                    action: recommendationText,
                    question: q.question
                };

                if (weight >= 2.0) {
                    recommendations.immediate.push({ ...recommendation, priority: "Critical", timeframe: "0-30 days" });
                } else if (weight >= 1.5) {
                    recommendations.shortTerm.push({ ...recommendation, priority: "Important", timeframe: "1-3 months" });
                } else {
                    recommendations.longTerm.push({ ...recommendation, priority: "Beneficial", timeframe: "3-12 months" });
                }
            }
        });
        return recommendations;
    }

    function getRecommendationForQuestion(questionId, currentScore) {
      const recommendationMap = {
        1: { 0: "Implement an immediate data backup solution using cloud storage (e.g., Google Drive, Dropbox) and test recovery.", 1: "Automate your backup processes to run daily or weekly and establish a formal, quarterly testing procedure." },
        2: { 0: "Develop a basic incident response plan (IRP) that defines roles, responsibilities, and key contacts.", 1: "Conduct quarterly tests of your IRP (tabletop exercises) and update the plan based on lessons learned." },
        3: { 0: "Conduct an initial business impact analysis (BIA) to identify your most critical processes and data.", 1: "Update your BIA annually and integrate its findings into your overall security strategy and IRP." },
        4: { 0: "Create a disaster recovery (DR) plan with clear, step-by-step procedures for critical system recovery.", 1: "Implement regular (at least bi-annual) DR testing and ensure all documentation is kept up-to-date." },
        5: { 0: "Implement a strong password policy (length, complexity) and enforce multi-factor authentication (MFA) for all critical services.", 1: "Deploy password vaults for all employees and begin implementing zero-trust access principles." },
        6: { 0: "Establish basic access controls by reviewing who has access to what and removing unnecessary permissions.", 1: "Implement a formal Role-Based Access Control (RBAC) policy based on the principle of least privilege." },
        7: { 0: "Begin monitoring and logging activities of all privileged accounts (e.g., administrator accounts).", 1: "Deploy an automated monitoring solution with real-time alerts for anomalous privileged account behavior." },
        8: { 0: "Implement basic logging for critical systems (servers, firewalls) and start monitoring for obvious threats.", 1: "Deploy a SIEM or XDR solution to centralize logs and enable proactive, real-time threat monitoring." },
        9: { 0: "Establish a formal process for collecting logs and assign responsibility for a basic weekly review.", 1: "Implement AI-driven log analysis and integrate external threat intelligence feeds for better detection." },
        10: { 0: "Install a reputable endpoint protection solution that goes beyond basic signature-based antivirus.", 1: "Deploy a full Endpoint Detection and Response (EDR) solution with behavioral detection and automated response." },
        11: { 0: "Initiate a mandatory, annual cybersecurity awareness training program for all staff.", 1: "Implement a continuous training program that includes regular updates and simulated attack exercises." },
        12: { 0: "Begin conducting quarterly phishing simulation tests for all employees to build awareness.", 1: "Establish a regular phishing testing program with the goal of decreasing failure rates over time." },
        13: { 0: "Develop and deliver role-specific security training for high-risk positions (e.g., finance, IT).", 1: "Expand tailored security training to cover all significant organizational roles and their specific risks." },
        14: { 0: "Schedule and conduct your first incident response drill (tabletop exercise) within the next quarter.", 1: "Implement a program of regular tabletop exercises and consider annual penetration testing." },
        15: { 0: "Develop a crisis communication plan that includes templates and contact lists for key stakeholders.", 1: "Fully integrate your communication strategy with your incident response procedures and test it during drills." },
        16: { 0: "Establish a formal patch management process with a regular schedule for applying security updates.", 1: "Deploy an automated patch management system to ensure critical updates are applied across all systems promptly." },
        17: { 0: "Implement basic backup and failover capabilities for your most critical server or application.", 1: "Establish a full redundancy and failover architecture, potentially with geo-distributed backup systems." },
        18: { 0: "Begin a compliance assessment against a relevant cybersecurity standard (like NIST CSF or CIS Controls).", 1: "Work towards full compliance with your chosen standard and establish regular internal or external audits." },
        19: { 0: "Conduct your first comprehensive organizational risk assessment to identify key security risks.", 1: "Implement a continuous risk management program with predictive analysis to stay ahead of new threats." },
        20: { 0: "Establish a basic security evaluation process for all new third-party vendors and software.", 1: "Deploy a comprehensive third-party vendor risk management program with ongoing monitoring." }
      };
      return recommendationMap[questionId] ? recommendationMap[questionId][currentScore] : null;
    }

    // --- js/storage.js ---
    const STORAGE_KEY = 'resilienceAssessment';

    function saveData(data) {
        try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        } catch (e) {
            console.error("Error saving data to localStorage", e);
        }
    }

    function loadData() {
        try {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : null;
        } catch (e) {
            console.error("Error loading data from localStorage", e);
            return null;
        }
    }

    function clearData() {
        try {
            localStorage.removeItem(STORAGE_KEY);
        } catch (e) {
            console.error("Error clearing data from localStorage", e);
        }
    }

    // --- js/export.js ---
    function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const resultsContent = document.getElementById('results-content');
        const resultsButtons = document.querySelector('#results-page .btn-group');

        // Hide buttons before capture
        resultsButtons.style.display = 'none';

        html2canvas(resultsContent, { scale: 2 }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;
            const ratio = canvasWidth / canvasHeight;
            const imgWidth = pdfWidth - 20; // with margin
            const imgHeight = imgWidth / ratio;

            let heightLeft = imgHeight;
            let position = 10; // top margin

            pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
            heightLeft -= (pdfHeight - 20);

            while (heightLeft > 0) {
                position = -heightLeft + 10; // Add margin for subsequent pages
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= (pdfHeight - 20);
            }

            pdf.save('Digital-Resilience-Assessment-Report.pdf');

            // Show buttons again
            resultsButtons.style.display = 'flex';
        });
    }


    // --- js/app.js ---
    document.addEventListener('DOMContentLoaded', () => {
        // State
        let currentQuestionIndex = 0;
        let answers = {};
        let organizationContext = [];

        // DOM Elements
        const views = {
            landing: document.getElementById('landing-page'),
            assessment: document.getElementById('assessment-page'),
            results: document.getElementById('results-page')
        };
        const startBtn = document.getElementById('start-assessment-btn');
        const continueBtn = document.getElementById('continue-assessment-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const finishBtn = document.getElementById('finish-btn');
        const saveBtn = document.getElementById('save-continue-btn');
        const retakeBtn = document.getElementById('retake-assessment-btn');
        const exportBtn = document.getElementById('export-pdf-btn');
        const homeBtn = document.getElementById('home-btn');
        const progressBar = document.getElementById('progress-bar');
        const questionCategoryEl = document.getElementById('question-category');
        const questionExplainerEl = document.getElementById('question-explainer');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const contextSection = document.getElementById('context-section');
        const contextOptionsContainer = document.getElementById('context-options-container');
        const errorMessageEl = document.getElementById('error-message');

        // --- Initialization ---
        function init() {
            const savedData = loadData();
            if (savedData && !savedData.completed) {
                continueBtn.style.display = 'inline-block';
            }

            startBtn.addEventListener('click', startNewAssessment);
            continueBtn.addEventListener('click', continueAssessment);
            prevBtn.addEventListener('click', showPreviousQuestion);
            nextBtn.addEventListener('click', showNextQuestion);
            finishBtn.addEventListener('click', finishAssessment);
            saveBtn.addEventListener('click', saveAndExit);
            retakeBtn.addEventListener('click', startNewAssessment);
            exportBtn.addEventListener('click', exportToPDF);
            homeBtn.addEventListener('click', () => showView('landing'));

            populateContextOptions();
        }

        // --- Navigation ---
        function showView(viewName) {
            Object.values(views).forEach(view => view.classList.remove('active'));
            views[viewName].classList.add('active');
        }

        // --- Assessment Logic ---
        function startNewAssessment() {
            currentQuestionIndex = 0;
            answers = {};
            organizationContext = [];
            clearData();
            showQuestion();
            showView('assessment');
        }

        function continueAssessment() {
            const savedData = loadData();
            if (savedData) {
                currentQuestionIndex = savedData.currentQuestion;
                answers = savedData.answers;
                organizationContext = savedData.organizationContext || [];
                showQuestion();
                showView('assessment');
            }
        }

        function populateContextOptions() {
            contextOptionsContainer.innerHTML = '';
            highRiskContexts.forEach(context => {
                const label = document.createElement('label');
                label.className = 'context-option';
                label.textContent = context.charAt(0).toUpperCase() + context.slice(1);

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = context;
                checkbox.addEventListener('change', () => {
                    label.classList.toggle('selected', checkbox.checked);
                    updateOrganizationContext();
                });

                label.prepend(checkbox);
                contextOptionsContainer.appendChild(label);
            });
        }

        function updateOrganizationContext() {
            organizationContext = Array.from(contextOptionsContainer.querySelectorAll('input:checked')).map(cb => cb.value);
        }

        function showQuestion() {
            errorMessageEl.style.display = 'none'; // Hide error on new question
            const question = questions[currentQuestionIndex];
            questionCategoryEl.textContent = question.category;
            questionExplainerEl.innerHTML = question.explainer;
            questionTextEl.textContent = question.question;

            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionId = `q${question.id}_o${index}`;
                const optionEl = document.createElement('div');
                optionEl.className = 'option';

                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = `q_${question.id}`;
                radio.id = optionId;
                radio.value = index;

                const label = document.createElement('label');
                label.htmlFor = optionId;
                label.textContent = option.text;

                optionEl.appendChild(radio);
                optionEl.appendChild(label);
                optionsContainer.appendChild(optionEl);

                radio.addEventListener('change', () => {
                    handleOptionSelect(question.id, option);
                });
            });

            // Show context section only on the first question
            contextSection.style.display = currentQuestionIndex === 0 ? 'block' : 'none';
            if(currentQuestionIndex === 0) {
                 // re-check boxes based on saved context
                contextOptionsContainer.querySelectorAll('input').forEach(cb => {
                    cb.checked = organizationContext.includes(cb.value);
                    cb.parentElement.classList.toggle('selected', cb.checked);
                });
            }

            updateProgress();
            updateNavigation();
            highlightSelectedOption();
        }

        function handleOptionSelect(questionId, optionData) {
            errorMessageEl.style.display = 'none'; // Hide error on selection
            answers[questionId] = optionData;
            highlightSelectedOption();
        }

        function highlightSelectedOption() {
            const question = questions[currentQuestionIndex];
            const selectedAnswer = answers[question.id];

            document.querySelectorAll('.option').forEach((optionEl, index) => {
                const isSelected = selectedAnswer && selectedAnswer.text === question.options[index].text;
                optionEl.classList.toggle('selected', isSelected);
                optionEl.querySelector('input').checked = isSelected;
            });
        }

        function showNextQuestion() {
            const currentQuestionId = questions[currentQuestionIndex].id;
            if (!answers[currentQuestionId]) {
                errorMessageEl.style.display = 'block';
                return; // Stop if no answer is selected
            }

            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function saveAndExit() {
            const dataToSave = {
                userId: 'user-' + Date.now(),
                startDate: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                currentQuestion: currentQuestionIndex,
                answers: answers,
                organizationContext: organizationContext,
                completed: false,
            };
            saveData(dataToSave);
            // Non-alert confirmation
            const saveBtnRef = document.getElementById('save-continue-btn');
            const originalText = saveBtnRef.textContent;
            saveBtnRef.textContent = 'Progress Saved!';
            setTimeout(() => {
                saveBtnRef.textContent = originalText;
                showView('landing');
            }, 1500);
        }

        function finishAssessment() {
            const currentQuestionId = questions[currentQuestionIndex].id;
            if (!answers[currentQuestionId]) {
                errorMessageEl.style.display = 'block';
                return; // Stop if final question is unanswered
            }

            const scoreData = calculateScores(answers);
            let layerResult = calculateLayer(scoreData);
            layerResult = applyContextualRisk(layerResult, organizationContext);

            const recommendations = generateRecommendations(answers);

            const results = {
                ...scoreData,
                layer: layerResult,
                recommendations,
            };

            const dataToSave = {
                ...loadData(),
                lastUpdated: new Date().toISOString(),
                currentQuestion: currentQuestionIndex,
                answers: answers,
                organizationContext: organizationContext,
                completed: true,
                results: results
            };

            saveData(dataToSave);
            displayResults(results);
            showView('results');
        }

        // --- UI Updates ---
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressBar.textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
        }

        function updateNavigation() {
            prevBtn.style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';
            nextBtn.style.display = currentQuestionIndex < questions.length - 1 ? 'inline-block' : 'none';
            finishBtn.style.display = currentQuestionIndex === questions.length - 1 ? 'inline-block' : 'none';
        }

        // --- Results Display ---
        function displayResults(results) {
            const { layer, categoryScores, recommendations } = results;

            // Summary
            const summaryEl = document.querySelector('.results-summary');
            summaryEl.style.backgroundColor = layer.color.replace('var(','').replace(')','');
            summaryEl.style.color = '#fff';
            document.getElementById('results-layer').textContent = layer.layer;
            const riskEl = document.getElementById('results-risk');
            riskEl.textContent = layer.risk;
            riskEl.style.backgroundColor = 'rgba(0,0,0,0.2)';
            document.getElementById('results-description').textContent = layer.description;

            const contextualNoteEl = document.getElementById('contextual-note');
            if (layer.contextualNote) {
                contextualNoteEl.textContent = layer.contextualNote;
                contextualNoteEl.style.display = 'block';
            } else {
                contextualNoteEl.style.display = 'none';
            }


            // Category Scores
            const categoryContainer = document.getElementById('category-scores-container');
            categoryContainer.innerHTML = '';
            for (const category in categoryScores) {
                const scoreData = categoryScores[category];
                const percentage = scoreData.maxScore > 0 ? (scoreData.score / scoreData.maxScore) * 100 : 0;

                const scoreEl = document.createElement('div');
                scoreEl.className = 'category-score';
                scoreEl.innerHTML = `
                    <span>${category}</span>
                    <div class="category-score-bar-container">
                        <div class="category-score-bar" style="width: ${percentage}%;"></div>
                    </div>
                    <span>${Math.round(percentage)}%</span>
                `;
                categoryContainer.appendChild(scoreEl);
            }

            // Threats
            const threatsList = document.getElementById('threats-list');
            threatsList.innerHTML = '';
            layer.threats.forEach(threat => {
                const li = document.createElement('li');
                li.textContent = threat;
                threatsList.appendChild(li);
            });

            // Recommendations
            const recContainer = document.getElementById('recommendations-container');
            recContainer.innerHTML = '';

            const recSections = {
                "Immediate Actions (0-30 days)": recommendations.immediate,
                "Short-term Goals (1-3 months)": recommendations.shortTerm,
                "Long-term Objectives (3-12 months)": recommendations.longTerm
            };

            for (const title in recSections) {
                if (recSections[title].length > 0) {
                    const sectionEl = document.createElement('div');
                    sectionEl.innerHTML = `<h3>${title}</h3>`;
                    const listEl = document.createElement('ul');
                    listEl.className = 'recommendations-list';

                    recSections[title].forEach(rec => {
                        const li = document.createElement('li');
                        li.className = 'recommendation-item';
                        li.innerHTML = `
                            <strong>${rec.question}</strong>
                            ${rec.action}
                            <div style="font-size: 0.8rem; color: #6c757d; margin-top: 0.5rem;">Category: ${rec.category}</div>
                        `;
                        listEl.appendChild(li);
                    });

                    sectionEl.appendChild(listEl);
                    recContainer.appendChild(sectionEl);
                }
            }
        }

        // --- Start the app ---
        init();
    });
    </script>
</body>
</html>
